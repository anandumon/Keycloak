services:
  - type: web
    name: keycloak
    env: docker
    plan: starter
    region: singapore
    branch: main
    dockerfilePath: ./Dockerfile
    healthCheckPath: /realms/master
    autoDeploy: true
    envVars:
      # --- Hostname Configuration ---
      - key: KC_HOSTNAME
        value: ${keycloak.url}
      - key: KC_HOSTNAME_STRICT
        value: "true"

      # --- Proxy Configuration ---
      - key: KC_PROXY
        value: edge

      # --- HTTP Configuration ---
      - key: KC_HTTP_ENABLED
        value: "true"
      - key: KC_HTTP_PORT
        value: "8080"

      # --- Cache Configuration ---
      # Use a local cache stack to prevent clustering issues on a single instance.
      - key: KC_CACHE_STACK
        value: local