services:
  - type: web
    name: keycloak
    env: docker
    plan: starter
    region: singapore
    branch: main
    dockerfilePath: ./Dockerfile
    healthCheckPath: /realms/master
    autoDeploy: true
    envVars:
      # --- Runtime Settings ---
      # These are set here because they are not secrets.

      # 1. Hostname Configuration (This is the fix)
      # Tells Keycloak its public URL. `${keycloak.url}` is a Render variable.
      - key: KC_HOSTNAME
        value: ${keycloak.url}
      # Enforces that requests match the configured hostname. This is required when KC_PROXY=edge.
      - key: KC_HOSTNAME_STRICT
        value: "true"

      # 2. Proxy Configuration
      # Tells Keycloak it's behind Render's reverse proxy.
      - key: KC_PROXY
        value: edge

      # 3. HTTP Configuration
      # Enables HTTP and sets the port Keycloak listens on inside the container.
      - key: KC_HTTP_ENABLED
        value: "true"
      - key: KC_HTTP_PORT
        value: "8080"